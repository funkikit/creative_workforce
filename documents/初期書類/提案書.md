# 提案書（技術スタック案）

## 1. 背景・目的
- 企画書で示された「クリエイティブ制作プロセスの全体支援」を実現するため、AIエージェントと各種ツール群を連携させたプラットフォームを構築する。
- 企画〜原画〜動画〜音響〜撮影までの成果物生成を、会話型インターフェースと自動タスク連携で滑らかに接続する必要がある。
- 本提案では主要コンポーネントごとに複数の候補技術を比較し、最適な組み合わせを選定した結果を整理する。

## 2. 要件整理
- LLMフロントがユーザーのリクエストを受け、背後の専門エージェントを呼び分ける。
- 各工程（企画設計、シナリオ生成、レイアウト・タイムシート生成、原画化、動画生成、音響追加、撮影・エフェクト）がデータとワークフローで接続される。
- 成果物と進行状況を横断的に管理できる共通データモデル・リポジトリが必要。
- MCPなど外部サービス呼び出しを柔軟に追加できる拡張性と、安全な権限管理が求められる。
@p
## 3. アーキテクチャ概要（PoC前提）
- 会話UI（Web） → 軽量オーケストレーションAPI → エージェント → モデル・外部ツール → 永続化基盤（GCP中心）のシンプル構造に絞る。
- PoCでは「企画〜シナリオ生成〜ラフ演出」のループに注力し、原画・動画・音響はサンプル生成に留める。
- データ層は Cloud SQL（PostgreSQL互換）で構造化データ、GCSで成果物ファイル、ベクトルDBで意味検索を最小構成とする。
- 長時間処理や大規模監視は次フェーズとし、Cloud Run や Cloud Functions のマネージドジョブで代替する。

## 4. 技術スタック比較と推奨

### 4.1 フロントエンド / 会話UI
|候補|長所|懸念|採用判断|
|---|---|---|---|
|Next.js (React) + Chakra UI + tRPC|エコシステムが成熟、LLMチャットUI実績多数、SSRでSEOも確保|初期学習コストは標準的|採用: 実績・拡張性・SSRのバランスが最適|
|SvelteKit + Skeleton UI|軽量で高速、コード量が少なく保守しやすい|エンタープライズ事例が相対的に少ない|補欠: 小規模チームなら有力だが周辺ライブラリが限定的|
|Flutter Web|単一コードベースでモバイル展開しやすい|Webでの描画が重く、LLM UIの柔軟なカスタマイズに弱い|非採用: 表現力とパフォーマンス両立が難しい|

### 4.2 API/バックエンド・エージェントオーケストレーション
|候補|長所|懸念|採用判断|
|---|---|---|---|
|FastAPI (Python) + LangChain/LangGraph + pydantic|PythonのAIエコシステムを活かしPoCでも高速開発、LangGraphで会話状態を柔軟に管理|Pythonでのテスト整備は別途必要|採用: PoCのスピードとLLMツール連携の実績から最適|
|Node.js (Next API Routes) + LangChain.js|フロントと統一言語で開発できる|生成AI向けライブラリがまだ限定的|補欠: チームがTypeScript中心なら代替案|
|Vertex AI Agents Builder|GCPネイティブ、ワークフローをGUI構築できる|カスタム処理の自由度が制限される|検討保留: 将来のGCPフル活用時に再評価|

### 4.3 LLMプロバイダ戦略
|候補|長所|懸念|採用判断|
|---|---|---|---|
|OpenAI GPT-5 (Chat Completions)|現行標準モデル、マルチモーダル入出力対応、品質が安定|トークン単価が高め|主力採用: 企画生成・構成整理・対話UIの中心|
|OpenAI o3-mini / gpt-4o-mini|軽量で高速、コストが低い|長文生成で破綻する場合あり|補完採用: アイデアブレストや多数案生成で併用|
|Claude 3.5 Sonnet|長文整形や安全性に強み|OpenAIと比べAPI併用で契約が増える|補欠: 長文レビューが必要な場合に適宜導入|

### 4.4 知識管理・RAG基盤
|候補|長所|懸念|採用判断|
|---|---|---|---|
|Cloud SQL (PostgreSQL) + SQLModel|GCPマネージドでセットアップが早い、JSONBで柔軟性確保|接続数上限に注意|採用: PoCでのデータ管理の第一候補|
|Firestore|スキーマレスで変更に強い|複雑な結合に弱い|補欠: スキーマ未確定なら短期的に利用|
|Neo4j Aura (GCP)|関係性・ストーリー依存解析に強い|PoCでの導入コストが高い|補助: 将来のストーリー分析フェーズで検討|

### 4.5 ベクトルDB / セマンティック検索
|候補|長所|懸念|採用判断|
|---|---|---|---|
|Vertex AI Vector Search (Matching Engine)|GCPネイティブ、スケール時に移行が容易|PoC利用でも課金が発生|採用: GCP一本化方針に合致|
|Qdrant Cloud (GCPリージョン)|OSS互換、使い慣れたAPI、無料枠あり|PoC無料枠が小さめ|補欠: コスト抑制を優先する場合|
|Weaviate Cloud (GCPデプロイ)|GraphQL操作、拡張機能が豊富|セットアップと学習コスト|様子見: 特殊検索要件が出たら再検討|

### 4.6 ワークフロー／ジョブ管理
|候補|長所|懸念|採用判断|
|---|---|---|---|
|Cloud Tasks + Cloud Run jobs|GCPマネージドでPoCから本番まで移行しやすい|細かな状態遷移は自前実装|採用: 短期構築・低運用負荷|
|Temporal Cloud|信頼性の高い長時間実行|初期導入コスト|補欠: 後続フェーズで大規模レンダリングが必要になった際に検討|
|Prefect Cloud|セットアップが簡単、Pythonフレンドリー|GCPサービスとの統合は追加実装が必要|参考: データパイプラインが増えたら選択肢|

### 4.7 メディア資産管理
|候補|長所|懸念|採用判断|
|---|---|---|---|
|Google Cloud Storage (GCS)|GCPで統合運用、ライフサイクル管理が簡単|リージョン選定と権限設計が必要|採用: PoCから本番まで一貫利用|
|Cloud Storage FUSE + GCE|POSIX互換が必要な場合に便利|PoCでは過剰|補欠: ローカルツール連携が増えたら検討|
|Firestore + ファイルBase64保管|API実装が単純|サイズ制限が厳しい|非採用: メディア向きではない|

### 4.8 生成系モジュール（画像合成）
|候補|用途|評価|採用判断|
|---|---|---|---|
|Gemini 2.5 Flash Image API|テキスト/ラフ入力からの高品質画像合成|GCP統合が容易、API課金|採用: プロダクト内での画像生成・提示機能の中核|
|ComfyUIワークフロー（外部活用）|ノードベースで細かな制御が可能|GPUリソース前提、プロダクト統合が重い|参考: 今回はプロダクト外での補完ツールとして紹介|

### 4.9 音響生成・合成
|候補|長所|懸念|採用判断|
|---|---|---|---|
|ElevenLabs API|自然なマルチボイス、SSML対応|API課金|採用: 試作〜本番まで一貫利用可|
|Azure Speech Studio|多言語対応と企業サポート|Azure依存|補欠: 企業利用でSLAが必要な場合|
|RVC + 自前ボイスモデル|完全カスタム可能|運用・学習コスト|補助: 特定キャラ音声のカスタム生成に限定運用|

### 4.10 撮影・エフェクト統合
|候補|長所|懸念|採用判断|
|---|---|---|---|
|Blender + Pythonスクリプト|OSSで自動化しやすい、Cloud Run Jobsでも処理可能|操作習熟が必要|採用: PoCの撮影サンプル生成に活用|
|Runway Gen-2 (撮影補助)|高品質エフェクトを迅速に生成|API課金が高め|補欠: 参考映像の作成時のみスポット利用|
|After Effects + Scripting|既存制作フローとの親和性|ライセンス・自動化の難易度|様子見: チームの既存資産が多い場合のみ検討|

### 4.11 インフラ・デプロイ基盤
|候補|長所|懸念|採用判断|
|---|---|---|---|
|Cloud Run + Cloud Build|コンテナを即時デプロイ、HTTP/イベントに対応|長時間処理は時間制限あり|採用: PoCのAPI/ジョブ実行基盤に最適|
|Compute Engine + Systemd|柔軟に制御できる|管理工数が増える|補欠: 専用GPU等が必要なときのみ|
|GKE (Autopilot)|K8sの柔軟性を確保|PoCにはセットアップが過剰|非採用: 将来大規模化した場合に再検討|

## 5. 導入ステップ提案（PoC中心）
1. **最小PoC**: Next.js + FastAPI + LangGraph を Cloud Run/Cloud Functions で繋ぎ、GPT-5を使った「企画→シナリオ→ラフ演出」生成とタスク指示の往復を確認。Cloud SQL・GCS・Vertex Vector Search を小規模構成で導入。
2. **PoC拡張**: Stable Diffusion/Blender/ElevenLabs をスポット的に接続し、Cloud Tasks で非同期処理を追加。生成成果をGCSに蓄積し、評価フローを整備。
3. **次フェーズ準備**: Vertex AIや他LLMの切替性、Cloud Run Jobsによるバッチ化、アクセス制御などを検証。長期監視やKubernetes化は必要になったタイミングで検討。

## 6. 期待される効果
- 企画から撮影までの工程を可視化し、エージェントによるタスク提案と進捗同期が可能になる。
- 複数AIモデルを用途別に最適化しつつ、共通データ基盤で成果物を蓄積できる。
- 将来的な機能追加（新モデル・外部API）を、モジュール単位で迅速に組み込むアーキテクチャを確保できる。

## 7. 参考資料
- 詳細な技術紹介・用途・料金メモは `documents/技術スタック資料/` 配下の各Markdownを参照。PoC検討時のスタック選定補助として活用可能。
